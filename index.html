<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
<title>Kexy Secure</title>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<style>
  :root{--accent:#0095f6;--bg:#000;}
  html,body{height:100%;margin:0;font-family:Arial,Helvetica,sans-serif;background:var(--bg);color:#fff;}
  iframe{width:100%;height:100vh;border:none;}
  #passwordScreen{position:fixed;inset:0;background:rgba(0,0,0,0.85);display:none;align-items:center;justify-content:center;flex-direction:column;z-index:9999;color:white;}
  #passwordScreen input{width:140px;padding:12px;font-size:20px;text-align:center;border-radius:10px;border:none;outline:none;}
  #passwordScreen button{margin-top:12px;padding:10px 18px;border-radius:10px;border:none;background:var(--accent);color:#fff;font-weight:600;}
  #passError{color:#ff8888;margin-top:10px;}
</style>
</head>
<body>

<!-- Password Overlay -->
<div id="passwordScreen">
  <h2>Enter 4-digit password (ddmm)</h2>
  <input id="passInput" maxlength="4" placeholder="****" inputmode="numeric" />
  <button id="passBtn">Unlock</button>
  <p id="passError"></p>
</div>

<!-- Iframe for off state or after unlock -->
<iframe id="mainFrame" src=""></iframe>

<script>
/* ---------------- Firebase config ---------------- */
const firebaseConfig = {
  apiKey: "AIzaSyCdaMeWKKI7P8_sNeVbjs4eRlnufQItlJI",
  authDomain: "video-call-a9749.firebaseapp.com",
  databaseURL: "https://video-call-a9749-default-rtdb.firebaseio.com",
  projectId: "video-call-a9749",
  storageBucket: "video-call-a9749.firebasestorage.app",
  messagingSenderId: "655086083238",
  appId: "1:655086083238:web:ec14414fb08712aa696867",
  measurementId: "G-4KR499NMHS"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ---------------- UI refs ---------------- */
const passwordScreen = document.getElementById('passwordScreen');
const passInput = document.getElementById('passInput');
const passBtn = document.getElementById('passBtn');
const passError = document.getElementById('passError');
const mainFrame = document.getElementById('mainFrame');

/* ---------------- helper: auto ddmm password ---------------- */
function getTodayPassword(){
  const d = new Date();
  const day = String(d.getDate()).padStart(2,'0');
  const month = String(d.getMonth()+1).padStart(2,'0');
  return day + month;
}

/* ---------------- show/hide ---------------- */
function showPassword(){ passwordScreen.style.display='flex'; mainFrame.style.display='none'; }
function showIframe(url){ passwordScreen.style.display='none'; mainFrame.style.display='block'; mainFrame.src = url; }

/* ---------------- listen to Firebase appStatus ---------------- */
const statusRef = db.ref('appStatus');
statusRef.on('value', snap=>{
  const s = snap.val();
  if(s === 'on'){
    showPassword();
  } else {
    showIframe('https://www.cricbuzz.com/cricket-series/9638/south-africa-tour-of-india-2025/matches');
  }
});

/* ---------------- password handling ---------------- */
passBtn.addEventListener('click', tryUnlock);
passInput.addEventListener('keydown', e=>{ if(e.key==='Enter') tryUnlock(); });

function tryUnlock(){
  const v = passInput.value.trim();
  if(v === getTodayPassword()){
    passError.textContent = '';
    showIframe(''); // Password correct, iframe blank or you can load any app URL here
  } else {
    passError.textContent='Wrong password';
    setTimeout(()=>passError.textContent='',2000);
  }
}
</script>
</body>
</html>
