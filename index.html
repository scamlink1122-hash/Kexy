<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
<title>Mobile Video Call + Chat (WebRTC + Firebase)</title>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<style>
:root{
  --accent:#0095f6;
  --bg-gradient: linear-gradient(135deg,#f09433 0%,#e6683c 25%,#dc2743 50%,#cc2366 75%,#bc1888 100%);
}
html,body{height:100%;margin:0;font-family:Arial,Helvetica,sans-serif;background:var(--bg-gradient);-webkit-font-smoothing:antialiased;}
#passwordScreen{
  position:fixed;inset:0;background:rgba(0,0,0,0.85);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9999;color:white;
}
#passwordScreen h2{margin:0 0 14px;font-size:22px;}
#passwordScreen input{width:140px;padding:12px;font-size:20px;text-align:center;border-radius:10px;border:none;outline:none;}
#passwordScreen button{margin-top:12px;padding:10px 18px;border-radius:10px;border:none;background:var(--accent);color:#fff;font-weight:600}

.app {
  position:relative;width:100%;height:100vh;display:flex;flex-direction:column;gap:6px;box-sizing:border-box;padding:8px;
}
.room-bar{
  display:flex;gap:8px;align-items:center;background:rgba(255,255,255,0.9);padding:8px;border-radius:10px;
}
.room-bar input{flex:1;padding:8px;border-radius:8px;border:1px solid #ddd}
.room-bar button{padding:8px 10px;border-radius:8px;border:none;background:var(--accent);color:#fff;font-weight:600}

.video-wrap{position:relative;flex:1;display:flex;align-items:center;justify-content:center;border-radius:12px;overflow:hidden;background:#000}
video{display:block;object-fit:cover;width:100%;height:100%}

#localVideo{
  position:absolute;right:12px;bottom:110px;width:110px;height:150px;border-radius:10px;border:2px solid rgba(255,255,255,0.9);background:#000;z-index:30;object-fit:cover;cursor:pointer;
  transition:all .25s ease;
}
#localVideo.minimized{width:80px;height:110px;opacity:0.9}
#remoteVideo.small{width:140px;height:190px;right:12px;bottom:110px;position:absolute;border-radius:10px;border:2px solid rgba(255,255,255,0.9);z-index:20;object-fit:cover}

.controls{
  display:flex;gap:12px;justify-content:center;align-items:center;padding:8px;
}
.controls button{
  flex:0 0 78px;height:48px;border-radius:999px;border:none;background:rgba(0,0,0,0.6);color:white;font-size:18px;display:flex;align-items:center;justify-content:center;gap:8px;
}
.controls button.end{background:#ff3b30}

.chat {
  background:rgba(255,255,255,0.95);border-radius:12px;padding:8px;display:flex;flex-direction:column;gap:8px;
  max-height:260px;overflow:hidden;
}
.messages{flex:1;overflow-y:auto;display:flex;flex-direction:column;gap:8px;padding:6px}
.msg{max-width:74%;padding:8px;border-radius:12px;background:#f1f1f1;color:#111}
.msg.sent{align-self:flex-end;background:#dcf8c6}
.msg.received{align-self:flex-start;background:#fff;border:1px solid #e2e2e2}

.chat-input{display:flex;gap:8px;align-items:center}
.chat-input input[type="text"]{flex:1;padding:10px;border-radius:10px;border:1px solid #ddd;outline:none}
.chat-input input[type="file"]{display:none}
.file-label{padding:10px 12px;border-radius:10px;background:var(--accent);color:#fff;cursor:pointer}

@media(min-width:900px){
  .app{max-width:900px;margin:10px auto;height:92vh}
  #localVideo{right:18px;bottom:120px}
}
</style>
</head>
<body>

<!-- PASSWORD SCREEN -->
<div id="passwordScreen">
  <h2>Enter Password</h2>
  <input id="passInput" placeholder="****" />
  <button id="passBtn">Unlock</button>
  <p id="passError" style="color:#ff8888;margin-top:10px"></p>
</div>

<!-- APP -->
<div class="app" id="app" style="display:none">
  <div class="room-bar">
    <input id="roomLink" readonly placeholder="Room link will generate when unlocked">
    <button id="copyBtn">Copy</button>
  </div>

  <div class="video-wrap" id="videoWrap">
    <video id="remoteVideo" autoplay playsinline></video>
    <video id="localVideo" autoplay muted playsinline></video>
  </div>

  <div class="controls">
    <button id="switchBtn">üîÑ</button>
    <button id="muteBtn">üé§</button>
    <button id="speakerBtn">üîä</button>
    <button id="endBtn" class="end">‚ùå</button>
  </div>

  <div class="chat">
    <div class="messages" id="messages"></div>
    <div class="chat-input">
      <input type="text" id="textInput" placeholder="Type a message..." />
      <label class="file-label" title="Send image/video">
        üìé
        <input type="file" id="fileInput" accept="image/*,video/*">
      </label>
      <button id="sendBtn" style="padding:10px 12px;background:var(--accent);color:#fff;border:none;border-radius:8px">Send</button>
    </div>
  </div>
</div>

<script>
// ---------------- Firebase Config ----------------
const firebaseConfig = {
  apiKey: "AIzaSyCdaMeWKKI7P8_sNeVbjs4eRlnufQItlJI",
  authDomain: "video-call-a9749.firebaseapp.com",
  databaseURL: "https://video-call-a9749-default-rtdb.firebaseio.com",
  projectId: "video-call-a9749",
  storageBucket: "video-call-a9749.firebasestorage.app",
  messagingSenderId: "655086083238",
  appId: "1:655086083238:web:ec14414fb08712aa696867",
  measurementId: "G-4KR499NMHS"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ---------------- RANDOM PASSWORD ----------------
let PASSWORD = Math.floor(1000 + Math.random() * 9000).toString();

// SHOW PASSWORD TO ADMIN
window.addEventListener("load", () => {
    const box = document.createElement("div");
    box.style.position = "fixed";
    box.style.top = "10px";
    box.style.left = "10px";
    box.style.background = "#ffffff";
    box.style.padding = "10px 15px";
    box.style.borderRadius = "8px";
    box.style.boxShadow = "0 0 5px rgba(0,0,0,0.3)";
    box.style.zIndex = "99999";
    box.style.fontSize = "16px";
    box.style.color = "black";
    box.innerHTML = "PASSWORD: <b>" + PASSWORD + "</b>";
    document.body.appendChild(box);
});

// ---------------- PASSWORD SCREEN ----------------
const passScreen = document.getElementById('passwordScreen');
const passInput = document.getElementById('passInput');
const passBtn = document.getElementById('passBtn');
const passError = document.getElementById('passError');
const appDiv = document.getElementById('app');

passBtn.addEventListener('click', tryUnlock);
passInput.addEventListener('keydown', e => { if(e.key === 'Enter') tryUnlock(); });

function tryUnlock(){
  if(passInput.value.trim() === PASSWORD){
    passScreen.style.display = 'none';
    appDiv.style.display = 'flex';
    initApp(); // start video call + chat
  } else {
    passError.textContent = 'Wrong password!';
    setTimeout(()=> passError.textContent = '', 2000);
  }
}

// ---------------- VIDEO + CHAT LOGIC ----------------
// (Ye same code jo pehle diya tha, WebRTC + Firebase + chat)

const remoteVideo = document.getElementById('remoteVideo');
const localVideo = document.getElementById('localVideo');
const switchBtn = document.getElementById('switchBtn');
const muteBtn = document.getElementById('muteBtn');
const speakerBtn = document.getElementById('speakerBtn');
const endBtn = document.getElementById('endBtn');
const messagesDiv = document.getElementById('messages');
const textInput = document.getElementById('textInput');
const fileInput = document.getElementById('fileInput');
const sendBtn = document.getElementById('sendBtn');

let localStream, pc, roomId;
let muted=false, speakerOn=true, facingMode='user';

function addMessage(text,type='received',fileType){
  const el = document.createElement('div');
  el.className='msg '+(type==='sent'?'sent':'received');
  if(fileType){
    if(fileType.startsWith('image')){
      const img=document.createElement('img'); img.src=text; img.style.maxWidth='220px'; img.style.borderRadius='8px'; el.appendChild(img);
    } else if(fileType.startsWith('video')){
      const v=document.createElement('video'); v.src=text; v.controls=true; v.style.maxWidth='220px'; v.style.borderRadius='8px'; el.appendChild(v);
    } else el.textContent='[file]';
  } else el.textContent=text;
  messagesDiv.appendChild(el);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

async function startLocalStream(){
  try{
    localStream = await navigator.mediaDevices.getUserMedia({video:{facingMode}, audio:true});
    localVideo.srcObject = localStream;
  }catch(e){ alert('Camera/Mic access required: '+e.message); console.error(e); }
}

async function initApp(){
  await startLocalStream();

  roomId = Math.random().toString(36).substring(2,10);
  document.getElementById('roomLink').value = location.href + '?room=' + roomId;

  const urlParams = new URLSearchParams(location.search);
  const joinRoom = urlParams.get('room');
  if(joinRoom){ roomId = joinRoom; joinCall(roomId); } else createCall(roomId);

  setupChat();
}

// (WebRTC createCall, joinCall, chat logic same as previous code)
// Controls: switchBtn, muteBtn, speakerBtn, endBtn, PIP swap
// Copy room link logic same as previous
</script>

</body>
</html>
